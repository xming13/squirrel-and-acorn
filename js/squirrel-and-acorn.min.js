var XMing=XMing||{};XMing.GameStateManager=new function(){var i,e,d,n=0,t=0,o=[],s={INITIAL:"initial",MENU:"menu",START:"start",PAUSE:"pause",END:"end"},r=[{acornNodes:[2,4,14],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:0,isFixed:!1},{index:2,direction:0,isFixed:!1},{index:3,direction:0,isFixed:!1},{index:4,direction:0,isFixed:!1},{index:5,direction:0,isFixed:!1},{index:6,direction:0,isFixed:!1},{index:7,direction:0,isFixed:!1},{index:8,direction:0,isFixed:!1},{index:9,direction:0,isFixed:!1},{index:10,direction:0,isFixed:!1},{index:11,direction:0,isFixed:!1},{index:12,direction:0,isFixed:!1},{index:13,direction:0,isFixed:!1},{index:14,direction:0,isFixed:!1},{index:15,direction:0,isFixed:!1},{index:16,direction:0,isFixed:!1},{index:17,direction:0,isFixed:!1},{index:18,direction:0,isFixed:!1},{index:19,direction:0,isFixed:!1},{index:20,direction:0,isFixed:!1},{index:21,direction:0,isFixed:!1},{index:22,direction:0,isFixed:!1},{index:23,direction:0,isFixed:!1},{index:24,direction:0,isFixed:!1}],disabledNodes:[]},{acornNodes:[6,12,18],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:1,isFixed:!0},{index:2,direction:0,isFixed:!1},{index:5,direction:2,isFixed:!0},{index:14,direction:1,isFixed:!1},{index:18,direction:0,isFixed:!1},{index:19,direction:2,isFixed:!0},{index:22,direction:2,isFixed:!1},{index:23,direction:1,isFixed:!0}],disabledNodes:[]},{acornNodes:[2,4,10,12,14,20,22],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:0,isFixed:!1},{index:12,direction:3,isFixed:!0},{index:19,direction:0,isFixed:!1},{index:23,direction:3,isFixed:!1}],disabledNodes:[6,8,16,18]},{acornNodes:[2,4,10,12,14,20,22],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:1,isFixed:!0},{index:2,direction:0,isFixed:!1},{index:3,direction:1,isFixed:!0},{index:4,direction:0,isFixed:!1},{index:5,direction:2,isFixed:!0},{index:6,direction:0,isFixed:!1},{index:7,direction:0,isFixed:!0},{index:8,direction:0,isFixed:!1},{index:9,direction:2,isFixed:!0},{index:10,direction:0,isFixed:!1},{index:11,direction:1,isFixed:!1},{index:12,direction:2,isFixed:!1},{index:13,direction:3,isFixed:!1},{index:14,direction:0,isFixed:!1},{index:15,direction:2,isFixed:!0},{index:16,direction:0,isFixed:!1},{index:17,direction:0,isFixed:!0},{index:18,direction:0,isFixed:!1},{index:19,direction:2,isFixed:!0},{index:20,direction:0,isFixed:!1},{index:21,direction:1,isFixed:!0},{index:22,direction:0,isFixed:!1},{index:23,direction:1,isFixed:!0},{index:24,direction:0,isFixed:!1}],disabledNodes:[11,13]},{acornNodes:[5,7,9,10,12,13,15,17,19],directionNodes:[{index:0,direction:2,isFixed:!1},{index:5,direction:3,isFixed:!1},{index:7,direction:3,isFixed:!0},{index:9,direction:3,isFixed:!0},{index:10,direction:1,isFixed:!0},{index:12,direction:1,isFixed:!0},{index:13,direction:1,isFixed:!0},{index:17,direction:3,isFixed:!0},{index:19,direction:3,isFixed:!0},{index:23,direction:2,isFixed:!1}],disabledNodes:[]},{acornNodes:[1,6,11,17,18,19],directionNodes:[{index:0,direction:3,isFixed:!1},{index:1,direction:1,isFixed:!0},{index:6,direction:0,isFixed:!0},{index:11,direction:1,isFixed:!0},{index:17,direction:2,isFixed:!0},{index:18,direction:0,isFixed:!0},{index:19,direction:2,isFixed:!0}],disabledNodes:[15,16,20,21]},{acornNodes:[5,7,9,16,18,21,23],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:0,isFixed:!1},{index:5,direction:2,isFixed:!0},{index:7,direction:2,isFixed:!0},{index:9,direction:2,isFixed:!0},{index:16,direction:0,isFixed:!0},{index:18,direction:0,isFixed:!0},{index:21,direction:1,isFixed:!0},{index:23,direction:1,isFixed:!0}],disabledNodes:[]},{acornNodes:[2,4,6,8,10,14,16,18,20,22],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:1,isFixed:!0},{index:2,direction:0,isFixed:!1},{index:3,direction:1,isFixed:!0},{index:4,direction:0,isFixed:!1},{index:5,direction:2,isFixed:!0},{index:6,direction:0,isFixed:!1},{index:7,direction:2,isFixed:!1},{index:8,direction:0,isFixed:!1},{index:9,direction:2,isFixed:!0},{index:10,direction:0,isFixed:!1},{index:11,direction:0,isFixed:!1},{index:13,direction:0,isFixed:!1},{index:14,direction:0,isFixed:!1},{index:15,direction:2,isFixed:!0},{index:16,direction:0,isFixed:!1},{index:17,direction:2,isFixed:!1},{index:18,direction:0,isFixed:!1},{index:19,direction:2,isFixed:!0},{index:20,direction:0,isFixed:!1},{index:21,direction:1,isFixed:!0},{index:22,direction:0,isFixed:!1},{index:23,direction:1,isFixed:!0},{index:24,direction:0,isFixed:!1}],disabledNodes:[12]},{acornNodes:[1,3,5,7,9,11,13,15,17,19,21,23],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:0,isFixed:!1},{index:11,direction:2,isFixed:!0},{index:13,direction:0,isFixed:!0},{index:19,direction:0,isFixed:!1},{index:23,direction:3,isFixed:!1}],disabledNodes:[]},{acornNodes:[2,4,6,8,10,14,16,18,20,22],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:1,isFixed:!0},{index:2,direction:0,isFixed:!1},{index:5,direction:2,isFixed:!0},{index:6,direction:2,isFixed:!1},{index:7,direction:3,isFixed:!0},{index:10,direction:2,isFixed:!1},{index:11,direction:3,isFixed:!1},{index:14,direction:0,isFixed:!1},{index:15,direction:3,isFixed:!1},{index:17,direction:1,isFixed:!0},{index:18,direction:3,isFixed:!1},{index:19,direction:2,isFixed:!0},{index:23,direction:1,isFixed:!0}],disabledNodes:[12]}],a=[{nodeIndex:0,direction:0},{nodeIndex:0,direction:3},{nodeIndex:1,direction:0},{nodeIndex:2,direction:0},{nodeIndex:3,direction:0},{nodeIndex:4,direction:0},{nodeIndex:4,direction:1},{nodeIndex:5,direction:3},{nodeIndex:9,direction:1},{nodeIndex:10,direction:3},{nodeIndex:14,direction:1},{nodeIndex:15,direction:3},{nodeIndex:19,direction:1},{nodeIndex:20,direction:3},{nodeIndex:20,direction:2},{nodeIndex:21,direction:2},{nodeIndex:22,direction:2},{nodeIndex:23,direction:2},{nodeIndex:24,direction:2},{nodeIndex:24,direction:1}];this.getDirectionClass=function(i){switch(i){case 0:return"up";case 1:return"right";case 2:return"down";case 3:return"left";default:return""}},this.addNodeDirectionClass=function(i,e){var d=_.matches({nodeIndex:i,direction:e}),n=_.filter(a,d);n.length>0||o[i].addClass(this.getDirectionClass(e))},this.checkPath=function(){for(var i=0,e=[],d=0,n=-1;d>-1;){var s=o[d],a=this.isGameStateEnd()?"node-gameover":"node-disabled";if(_.contains(e,s)||s.hasClass(a)){var c=e[e.length-1],x=c.data("direction"),l=s.data("direction");2!=Math.abs(l-x)&&c.removeClass(this.getDirectionClass(x)),d=-1}else if(s.removeClass("up right down left"),s.addClass("selected"),this.addNodeDirectionClass(d,n),e.push(s),s.hasClass("node-acorn")&&i++,24==d)d=-1;else{var m=s.data("direction");switch(this.addNodeDirectionClass(d,m),m){case 0:d=4>=d?-1:d-5,n=2;break;case 1:d=d%5==4?-1:d+1,n=3;break;case 2:d=d>=20?-1:d+5,n=0;break;case 3:d=d%5==0?-1:d-1,n=1}}}_.each(_.difference(o,e),function(i){i.removeClass("selected up right down left")});var F=this.isGameStateEnd()?15:r[t].acornNodes.length;return 24==_.indexOf(o,_.last(e))?i===F?!0:(_.each(o,function(i){if(i.hasClass("node-acorn")&&!i.hasClass("selected")){i.addClass("warning");var e=i.find(".acorn");e.addClass("animated flash"),e.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){i.removeClass("warning"),e.removeClass("animated flash")})}}),!1):!1},this.setupGrid=function(){$(".round-number").html("Round "+(t+1)),$(".board-grid").html(""),o=[];for(var i=0;25>i;i++){var e=r[t],d=$("<li>");if(_.contains(e.disabledNodes,i))d.addClass("node-disabled");else{var n;if(24==i)n=$("<img>",{src:"images/acorn_big.png","class":"acorn acorn-big animated rubberBand"}),d.append(n);else{n=$("<img>",{src:"images/arrow.png","class":"arrow"});var s=_.filter(e.directionNodes,_.matches({index:i}));if(s.length>0){var a=s[0];n.transition({rotate:90*a.direction+"deg"}),d.data("direction",a.direction),a.isFixed&&d.addClass("node-fixed")}else{var c=0==i?0:_.random(3);n.transition({rotate:90*c+"deg"}),d.data("direction",c)}if(d.append(n),0==i){var x=$("<img>",{src:"images/squirrel.png","class":"squirrel animated bounce"});d.append(x)}}}if(_.contains(e.acornNodes,i)){d.addClass("node-acorn");var l=$("<img>",{src:"images/acorn.png","class":"acorn"});d.append(l)}o.push(d),$(".board-grid").append(d)}this.checkPath(),$(".board-grid").addClass("animated fadeIn"),$(".board-grid.animated.fadeIn").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".board-grid.animated.fadeIn").removeClass("animated fadeIn")})},this.setupGameNode=function(){if(t===r.length)this.endGame();else{var i=this;this.setupGrid(),$("ul.board-grid li:not(.node-fixed):not(.node-disabled)").click(function(){$(this).data("direction",($(this).data("direction")+1)%4),$(this).find("img.arrow").transition({rotate:"+=90deg"}),i.checkPath()&&(e.level===t&&(e.level++,i.saveData(e)),_.delay(function(){swal({title:"Congrats!",text:"Go to the next stage!",type:"success",confirmButtonText:"Next",confirmButtonColor:"#59FF6D",showCancelButton:!0,cancelButtonText:"Menu",closeOnConfirm:t+1!=r.length},function(e){e?(t++,i.setupGameNode()):i.menuGame()})},300))})}},this.preloadImage=function(){var i=new Image;i.src="images/love.png"},this.onResize=function(){if($(window).width()!=n){n=$(window).width(),d&&d.html("");var i=$(".grid").children("li"),e=_.max(i,function(i){return $(i).width()}),t=$(e).width(),o="<style> ul.grid { width: "+(5*t+2)+"px; }  .grid li { height: "+t+"px; width: "+t+"px; }  .grid li .content { font-size: "+.5*t+"px; }  .game-letters span { font-size: "+.2*t+"px; margin-left: "+.1*t+"px; } </style>";d?d.html(o):d=$("<div />",{html:o}).appendTo("body")}},this.initGame=function(){var d=this;i=s.INITIAL,FastClick.attach(document.body),window.addEventListener("resize",this.onResize.bind(this),!1),d.preloadImage(),e=this.loadData(),$(".btn-play").click(function(){$("#panel-main").hide(),$("#panel-game").show(),d.menuGame()}),$(".icon-menu").click(function(){t<r.length?swal({title:"Are you sure?",text:"Progress for this round (Round "+(t+1)+") will be gone.",type:"warning",showCancelButton:!0},function(){d.menuGame()}):d.menuGame()})},this.menuGame=function(){var d=this;i=s.MENU,$(".icon-menu-holder").hide(),$(".menu").show(),$(".board").hide(),$(".round-number").html("&nbsp;"),n=0,this.onResize(),$(".menu-grid").html("");for(var t=0;25>t;t++){var o=$("<li>");t<=r.length-1?t>e.level?o.addClass("locked"):(o.html(t===e.level?'<img src="images/acorn.png" class="acorn-big animated tada"/><span>'+t+"</span>":'<img src="images/acorn.png" class="acorn-big"/><span>'+t+"</span>"),function(i){o.click(function(){d.startGame(i)})}(t)):t===r.length?t>e.level?o.addClass("locked"):(o.html('<img src="images/love.png" style="width:80%; height:80%; margin: 10%;"/>'),o.click(function(){d.endGame()})):o.addClass("disabled"),$(".menu-grid").append(o)}$("html, body").animate({scrollTop:$("#panel-container").offset().top},"fast")},this.startGame=function(e){i=s.START,$(".icon-menu-holder").show(),$(".menu").hide(),$(".board").show(),t=e,this.setupGameNode(),$("html, body").animate({scrollTop:$("#panel-container").offset().top},"fast")},this.endGame=function(){i=s.END;var e=this;t=r.length,$(".icon-menu-holder").show(),$(".menu").hide(),$(".board").show(),$(".board-grid").html("");var d={acornNodes:[1,2,3,4,9,10,11,12,13,14,15,20,21,22,23],letterNodes:[{index:5,letter:"G"},{index:6,letter:"A"},{index:7,letter:"M"},{index:8,letter:"E"},{index:16,letter:"O"},{index:17,letter:"V"},{index:18,letter:"E"},{index:19,letter:"R"}],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:0,isFixed:!1},{index:4,direction:2,isFixed:!0},{index:10,direction:2,isFixed:!0},{index:14,direction:3,isFixed:!0},{index:20,direction:1,isFixed:!0},{index:23,direction:3,isFixed:!1}]};o=[];for(var n=0;25>n;n++){var a,c=$("<li>");if(24==n)a=$("<img>",{src:"images/acorn_big.png","class":"acorn acorn-big animated rubberBand"}),c.append(a);else{var x=_.filter(d.letterNodes,_.matches({index:n}));if(x.length>0){var l=$("<div>",{"class":"content animated fadeIn letter",html:x[0].letter});c.append(l),c.addClass("node-gameover")}else{a=$("<img>",{src:"images/arrow.png","class":"arrow"});var m=_.filter(d.directionNodes,_.matches({index:n}));if(m.length>0){var F=m[0];a.transition({rotate:90*F.direction+"deg"}),c.data("direction",F.direction),F.isFixed&&c.addClass("node-fixed")}else{var h=0==n?0:_.random(3);a.transition({rotate:90*h+"deg"}),c.data("direction",h)}if(c.append(a),0==n){var g=$("<img>",{src:"images/squirrel.png","class":"squirrel animated bounce"});c.append(g)}}}if(_.contains(d.acornNodes,n)){c.addClass("node-acorn");var u=$("<img>",{src:"images/acorn.png","class":"acorn"});c.append(u)}o.push(c),$(".board-grid").append(c)}this.checkPath();var f=!1;$("ul.board-grid li:not(.node-fixed):not(.node-disabled)").click(function(){$(this).data("direction",($(this).data("direction")+1)%4),$(this).find("img.arrow").transition({rotate:"+=90deg"}),e.checkPath()&&!f&&swal({title:"8512",text:"The number of different paths for the squirrel to move from top left to bottom right without visiting the same square twice!",imageUrl:"images/main_squirrel.png",closeOnConfirm:!1},function(){swal({title:"Thanks for playing!!!",imageUrl:"images/love.png"}),f=!0})}),$(".letter").click(function(){$(this).addClass("shake")}),$(".letter").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("shake fadeIn")})},this.isGameStateInitial=function(){return i==s.INITIAL},this.isGameStateStart=function(){return i==s.START},this.isGameStateEnd=function(){return i==s.END},this.saveData=function(i){window.localStorage&&window.localStorage.setItem("data",btoa(encodeURIComponent(JSON.stringify(i))))},this.loadData=function(){if(window.localStorage){var i=window.localStorage.getItem("data");if(i)return i&&JSON.parse(decodeURIComponent(atob(i)))}return{level:0}}};