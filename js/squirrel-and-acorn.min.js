var XMing=XMing||{};XMing.GameStateManager=new function(){var i,e,d=0,n=0,t=[],o={INITIAL:"initial",START:"start",PAUSE:"pause",END:"end"},s=[{acornNodes:[2,4,14],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:0,isFixed:!1},{index:2,direction:0,isFixed:!1},{index:3,direction:0,isFixed:!1},{index:4,direction:0,isFixed:!1},{index:5,direction:0,isFixed:!1},{index:6,direction:0,isFixed:!1},{index:7,direction:0,isFixed:!1},{index:8,direction:0,isFixed:!1},{index:9,direction:0,isFixed:!1},{index:10,direction:0,isFixed:!1},{index:11,direction:0,isFixed:!1},{index:12,direction:0,isFixed:!1},{index:13,direction:0,isFixed:!1},{index:14,direction:0,isFixed:!1},{index:15,direction:0,isFixed:!1},{index:16,direction:0,isFixed:!1},{index:17,direction:0,isFixed:!1},{index:18,direction:0,isFixed:!1},{index:19,direction:0,isFixed:!1},{index:20,direction:0,isFixed:!1},{index:21,direction:0,isFixed:!1},{index:22,direction:0,isFixed:!1},{index:23,direction:0,isFixed:!1},{index:24,direction:0,isFixed:!1}],disabledNodes:[]},{acornNodes:[6,12,18],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:1,isFixed:!0},{index:2,direction:0,isFixed:!1},{index:5,direction:2,isFixed:!0},{index:14,direction:1,isFixed:!1},{index:18,direction:0,isFixed:!1},{index:19,direction:2,isFixed:!0},{index:22,direction:2,isFixed:!1},{index:23,direction:1,isFixed:!0}],disabledNodes:[]},{acornNodes:[2,4,10,12,14,20,22],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:0,isFixed:!1},{index:12,direction:3,isFixed:!0},{index:19,direction:0,isFixed:!1},{index:23,direction:3,isFixed:!1}],disabledNodes:[6,8,16,18]},{acornNodes:[2,4,10,12,14,20,22],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:1,isFixed:!0},{index:2,direction:0,isFixed:!1},{index:3,direction:1,isFixed:!0},{index:4,direction:0,isFixed:!1},{index:5,direction:2,isFixed:!0},{index:6,direction:0,isFixed:!1},{index:7,direction:0,isFixed:!0},{index:8,direction:0,isFixed:!1},{index:9,direction:2,isFixed:!0},{index:10,direction:0,isFixed:!1},{index:11,direction:1,isFixed:!1},{index:12,direction:2,isFixed:!1},{index:13,direction:3,isFixed:!1},{index:14,direction:0,isFixed:!1},{index:15,direction:2,isFixed:!0},{index:16,direction:0,isFixed:!1},{index:17,direction:0,isFixed:!0},{index:18,direction:0,isFixed:!1},{index:19,direction:2,isFixed:!0},{index:20,direction:0,isFixed:!1},{index:21,direction:1,isFixed:!0},{index:22,direction:0,isFixed:!1},{index:23,direction:1,isFixed:!0},{index:24,direction:0,isFixed:!1}],disabledNodes:[11,13]},{acornNodes:[5,7,9,10,12,13,15,17,19],directionNodes:[{index:0,direction:2,isFixed:!1},{index:5,direction:3,isFixed:!1},{index:7,direction:3,isFixed:!0},{index:9,direction:3,isFixed:!0},{index:10,direction:1,isFixed:!0},{index:12,direction:1,isFixed:!0},{index:13,direction:1,isFixed:!0},{index:17,direction:3,isFixed:!0},{index:19,direction:3,isFixed:!0},{index:23,direction:2,isFixed:!1}],disabledNodes:[]},{acornNodes:[1,6,11,17,18,19],directionNodes:[{index:0,direction:3,isFixed:!1},{index:1,direction:1,isFixed:!0},{index:6,direction:0,isFixed:!0},{index:11,direction:1,isFixed:!0},{index:17,direction:2,isFixed:!0},{index:18,direction:0,isFixed:!0},{index:19,direction:2,isFixed:!0}],disabledNodes:[15,16,20,21]},{acornNodes:[5,7,9,16,18,21,23],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:0,isFixed:!1},{index:5,direction:2,isFixed:!0},{index:7,direction:2,isFixed:!0},{index:9,direction:2,isFixed:!0},{index:16,direction:0,isFixed:!0},{index:18,direction:0,isFixed:!0},{index:21,direction:1,isFixed:!0},{index:23,direction:1,isFixed:!0}],disabledNodes:[]},{acornNodes:[2,4,6,8,10,14,16,18,20,22],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:1,isFixed:!0},{index:2,direction:0,isFixed:!1},{index:3,direction:1,isFixed:!0},{index:4,direction:0,isFixed:!1},{index:5,direction:2,isFixed:!0},{index:6,direction:0,isFixed:!1},{index:7,direction:2,isFixed:!1},{index:8,direction:0,isFixed:!1},{index:9,direction:2,isFixed:!0},{index:10,direction:0,isFixed:!1},{index:11,direction:0,isFixed:!1},{index:13,direction:0,isFixed:!1},{index:14,direction:0,isFixed:!1},{index:15,direction:2,isFixed:!0},{index:16,direction:0,isFixed:!1},{index:17,direction:2,isFixed:!1},{index:18,direction:0,isFixed:!1},{index:19,direction:2,isFixed:!0},{index:20,direction:0,isFixed:!1},{index:21,direction:1,isFixed:!0},{index:22,direction:0,isFixed:!1},{index:23,direction:1,isFixed:!0},{index:24,direction:0,isFixed:!1}],disabledNodes:[12]},{acornNodes:[1,3,5,7,9,11,13,15,17,19,21,23],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:0,isFixed:!1},{index:11,direction:2,isFixed:!0},{index:13,direction:0,isFixed:!0},{index:19,direction:0,isFixed:!1},{index:23,direction:3,isFixed:!1}],disabledNodes:[]},{acornNodes:[2,4,6,8,10,14,16,18,20,22],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:1,isFixed:!0},{index:2,direction:0,isFixed:!1},{index:5,direction:2,isFixed:!0},{index:6,direction:2,isFixed:!1},{index:7,direction:3,isFixed:!0},{index:10,direction:2,isFixed:!1},{index:11,direction:3,isFixed:!1},{index:14,direction:0,isFixed:!1},{index:15,direction:3,isFixed:!1},{index:17,direction:1,isFixed:!0},{index:18,direction:3,isFixed:!1},{index:19,direction:2,isFixed:!0},{index:23,direction:1,isFixed:!0}],disabledNodes:[12]}],r=[{nodeIndex:0,direction:0},{nodeIndex:0,direction:3},{nodeIndex:1,direction:0},{nodeIndex:2,direction:0},{nodeIndex:3,direction:0},{nodeIndex:4,direction:0},{nodeIndex:4,direction:1},{nodeIndex:5,direction:3},{nodeIndex:9,direction:1},{nodeIndex:10,direction:3},{nodeIndex:14,direction:1},{nodeIndex:15,direction:3},{nodeIndex:19,direction:1},{nodeIndex:20,direction:3},{nodeIndex:20,direction:2},{nodeIndex:21,direction:2},{nodeIndex:22,direction:2},{nodeIndex:23,direction:2},{nodeIndex:24,direction:2},{nodeIndex:24,direction:1}];this.init=function(){window.addEventListener("resize",this.onResize.bind(this),!1),this.initGame()},this.getDirectionClass=function(i){var e="";switch(i){case 0:e="up";break;case 1:e="right";break;case 2:e="down";break;case 3:e="left"}return e},this.addNodeDirectionClass=function(i,e){var d=_.matches({nodeIndex:i,direction:e}),n=_.filter(r,d);n.length>0||t[i].addClass(this.getDirectionClass(e))},this.checkPath=function(i){for(var e=0,d=[],o=0,r=-1;o>-1;){var a=t[o],x=i?"node-gameover":"node-disabled";if(_.contains(d,a)||a.hasClass(x)){var c=d[d.length-1],l=c.data("direction"),F=a.data("direction");2!=Math.abs(F-l)&&c.removeClass(this.getDirectionClass(l)),o=-1}else if(a.removeClass("up right down left"),a.addClass("selected"),this.addNodeDirectionClass(o,r),d.push(a),a.hasClass("node-acorn")&&e++,24==o)o=-1;else{var m=a.data("direction");switch(this.addNodeDirectionClass(o,m),m){case 0:o=4>=o?-1:o-5,r=2;break;case 1:o=o%5==4?-1:o+1,r=3;break;case 2:o=o>=20?-1:o+5,r=0;break;case 3:o=o%5==0?-1:o-1,r=1}}}_.each(_.difference(t,d),function(i){i.removeClass("selected up right down left")});var h=i?15:s[n].acornNodes.length;return 24==_.indexOf(t,_.last(d))?e==h?!0:(_.each(t,function(i){if(i.hasClass("node-acorn")&&!i.hasClass("selected")){i.addClass("warning");var e=i.find(".acorn");e.addClass("animated flash"),e.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){i.removeClass("warning"),e.removeClass("animated flash")})}}),!1):!1},this.loadGrid=function(){$(".game-grid").html(""),t=[];for(var i=0;25>i;i++){var e=s[n],d=$("<li>");if(_.contains(e.disabledNodes,i))d.addClass("node-disabled");else{var o;if(24==i)o=$("<img>",{src:"images/acorn_big.png","class":"acorn acorn-big animated rubberBand"}),d.append(o);else{o=$("<img>",{src:"images/arrow.png","class":"arrow"});var r=_.filter(e.directionNodes,_.matches({index:i}));if(r.length>0){var a=r[0];o.transition({rotate:90*a.direction+"deg"}),d.data("direction",a.direction),a.isFixed&&d.addClass("node-fixed")}else{var x=0==i?0:_.random(3);o.transition({rotate:90*x+"deg"}),d.data("direction",x)}if(d.append(o),0==i){var c=$("<img>",{src:"images/squirrel.png","class":"squirrel animated bounce"});d.append(c)}}}if(_.contains(e.acornNodes,i)){d.addClass("node-acorn");var l=$("<img>",{src:"images/acorn.png","class":"acorn"});d.append(l)}t.push(d),$(".game-grid").append(d)}this.checkPath(!1),$(".game-grid").addClass("animated fadeIn"),$(".game-grid.animated.fadeIn").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".game-grid.animated.fadeIn").removeClass("animated fadeIn")})},this.loadData=function(){var i=this;this.loadGrid(),$("ul.game-grid li:not(.node-fixed):not(.node-disabled)").click(function(){$(this).data("direction",($(this).data("direction")+1)%4),$(this).find("img.arrow").transition({rotate:"+=90deg"}),i.checkPath(!1)&&_.delay(function(){swal({title:"Good Job!",type:"success",confirmButtonText:"Next",confirmButtonColor:"#59FF6D",closeOnConfirm:n+1!=s.length},function(){i.loadNextRound(),$("html, body").animate({scrollTop:$("#panel-container").offset().top},"fast")})},300)})},this.loadNextRound=function(){var i=this;++n==s.length?i.endGame():i.loadData()},this.onResize=function(){if($(window).width()!=d){d=$(window).width(),e&&e.html("");var i=$(".game-grid").children("li"),n=_.max(i,function(i){return $(i).width()}),t=$(n).width(),o="<style> ul.game-grid { width: "+(5*t+2)+"px; }  .game-grid li { height: "+t+"px; width: "+t+"px; }  .game-grid li .content { font-size: "+.5*t+"px; }  #result-content { font-size: "+.8*t+"px; }  .game-letters span { font-size: "+.2*t+"px; margin-left: "+.1*t+"px; } </style>";e?e.html(o):e=$("<div />",{html:o}).appendTo("body")}},this.preloadImage=function(){var i=new Image;i.src="images/love.png"},this.initGame=function(){i=o.INITIAL,this.preloadImage();var e=this;$(".icon-repeat").click(function(){e.startGame()})},this.startGame=function(){i=o.START,n=0,$("#replay").hide(),this.loadData(),d=0,this.onResize()},this.endGame=function(){i=o.END;var e=this;$(".game-grid").html("");var d={acornNodes:[1,2,3,4,9,10,11,12,13,14,15,20,21,22,23],letterNodes:[{index:5,letter:"G"},{index:6,letter:"A"},{index:7,letter:"M"},{index:8,letter:"E"},{index:16,letter:"O"},{index:17,letter:"V"},{index:18,letter:"E"},{index:19,letter:"R"}],directionNodes:[{index:0,direction:1,isFixed:!1},{index:1,direction:0,isFixed:!1},{index:4,direction:2,isFixed:!0},{index:10,direction:2,isFixed:!0},{index:14,direction:3,isFixed:!0},{index:20,direction:1,isFixed:!0},{index:23,direction:3,isFixed:!1}]};t=[];for(var n=0;25>n;n++){var s,r=$("<li>");if(24==n)s=$("<img>",{src:"images/acorn_big.png","class":"acorn acorn-big animated rubberBand"}),r.append(s);else{var a=_.filter(d.letterNodes,_.matches({index:n}));if(a.length>0){var x=$("<div>",{"class":"content animated fadeIn letter",html:a[0].letter});r.append(x),r.addClass("node-gameover")}else{s=$("<img>",{src:"images/arrow.png","class":"arrow"});var c=_.filter(d.directionNodes,_.matches({index:n}));if(c.length>0){var l=c[0];s.transition({rotate:90*l.direction+"deg"}),r.data("direction",l.direction),l.isFixed&&r.addClass("node-fixed")}else{var F=0==n?0:_.random(3);s.transition({rotate:90*F+"deg"}),r.data("direction",F)}if(r.append(s),0==n){var m=$("<img>",{src:"images/squirrel.png","class":"squirrel animated bounce"});r.append(m)}}}if(_.contains(d.acornNodes,n)){r.addClass("node-acorn");var h=$("<img>",{src:"images/acorn.png","class":"acorn"});r.append(h)}t.push(r),$(".game-grid").append(r)}this.checkPath(!0),$("#replay").show();var g=!1;$("ul.game-grid li:not(.node-fixed):not(.node-disabled)").click(function(){$(this).data("direction",($(this).data("direction")+1)%4),$(this).find("img.arrow").transition({rotate:"+=90deg"}),e.checkPath(!0)&&!g&&(swal({title:"8512",text:"The number of different paths for the squirrel to move from top left to bottom right without visiting the same square twice!",imageUrl:"images/main_squirrel.png"}),g=!0)}),$(".letter").click(function(){$(this).addClass("shake")}),$(".letter").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("shake fadeIn")}),swal({title:"Thanks for playing!!!",imageUrl:"images/love.png"})},this.isGameStateInitial=function(){return i==o.INITIAL},this.isGameStateStart=function(){return i==o.START},this.isGameStateEnd=function(){return i==o.END}};