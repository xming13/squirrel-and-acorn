var XMing=XMing||{};XMing.GameStateManager=new function(){var e=0;var t;var n=0;var r=[];var i;var s={INITIAL:"initial",START:"start",PAUSE:"pause",END:"end"};var o=[{acornNodes:[2,4,14],directionNodes:[{index:0,direction:1,isFixed:false},{index:1,direction:0,isFixed:false},{index:2,direction:0,isFixed:false},{index:3,direction:0,isFixed:false},{index:4,direction:0,isFixed:false},{index:5,direction:0,isFixed:false},{index:6,direction:0,isFixed:false},{index:7,direction:0,isFixed:false},{index:8,direction:0,isFixed:false},{index:9,direction:0,isFixed:false},{index:10,direction:0,isFixed:false},{index:11,direction:0,isFixed:false},{index:12,direction:0,isFixed:false},{index:13,direction:0,isFixed:false},{index:14,direction:0,isFixed:false},{index:15,direction:0,isFixed:false},{index:16,direction:0,isFixed:false},{index:17,direction:0,isFixed:false},{index:18,direction:0,isFixed:false},{index:19,direction:0,isFixed:false},{index:20,direction:0,isFixed:false},{index:21,direction:0,isFixed:false},{index:22,direction:0,isFixed:false},{index:23,direction:0,isFixed:false},{index:24,direction:0,isFixed:false}],disabledNodes:[]},{acornNodes:[6,12,18],directionNodes:[{index:0,direction:1,isFixed:false},{index:1,direction:1,isFixed:true},{index:2,direction:0,isFixed:false},{index:5,direction:2,isFixed:true},{index:14,direction:1,isFixed:false},{index:18,direction:0,isFixed:false},{index:19,direction:2,isFixed:true},{index:22,direction:2,isFixed:false},{index:23,direction:1,isFixed:true}],disabledNodes:[]},{acornNodes:[2,4,10,12,14,20,22],directionNodes:[{index:0,direction:1,isFixed:false},{index:1,direction:0,isFixed:false},{index:12,direction:3,isFixed:true},{index:19,direction:0,isFixed:false},{index:23,direction:3,isFixed:false}],disabledNodes:[6,8,16,18]},{acornNodes:[2,4,10,12,14,20,22],directionNodes:[{index:0,direction:1,isFixed:false},{index:1,direction:1,isFixed:true},{index:2,direction:0,isFixed:false},{index:3,direction:1,isFixed:true},{index:4,direction:0,isFixed:false},{index:5,direction:2,isFixed:true},{index:6,direction:0,isFixed:false},{index:7,direction:0,isFixed:true},{index:8,direction:0,isFixed:false},{index:9,direction:2,isFixed:true},{index:10,direction:0,isFixed:false},{index:11,direction:1,isFixed:false},{index:12,direction:2,isFixed:false},{index:13,direction:3,isFixed:false},{index:14,direction:0,isFixed:false},{index:15,direction:2,isFixed:true},{index:16,direction:0,isFixed:false},{index:17,direction:0,isFixed:true},{index:18,direction:0,isFixed:false},{index:19,direction:2,isFixed:true},{index:20,direction:0,isFixed:false},{index:21,direction:1,isFixed:true},{index:22,direction:0,isFixed:false},{index:23,direction:1,isFixed:true},{index:24,direction:0,isFixed:false}],disabledNodes:[11,13]},{acornNodes:[5,7,9,10,12,13,15,17,19],directionNodes:[{index:0,direction:2,isFixed:false},{index:5,direction:3,isFixed:false},{index:7,direction:3,isFixed:true},{index:9,direction:3,isFixed:true},{index:10,direction:1,isFixed:true},{index:12,direction:1,isFixed:true},{index:13,direction:1,isFixed:true},{index:17,direction:3,isFixed:true},{index:19,direction:3,isFixed:true},{index:23,direction:2,isFixed:false}],disabledNodes:[]},{acornNodes:[1,6,11,17,18,19],directionNodes:[{index:0,direction:3,isFixed:false},{index:1,direction:1,isFixed:true},{index:6,direction:0,isFixed:true},{index:11,direction:1,isFixed:true},{index:17,direction:2,isFixed:true},{index:18,direction:0,isFixed:true},{index:19,direction:2,isFixed:true}],disabledNodes:[15,16,20,21]},{acornNodes:[5,7,9,16,18,21,23],directionNodes:[{index:0,direction:1,isFixed:false},{index:1,direction:0,isFixed:false},{index:5,direction:2,isFixed:true},{index:7,direction:2,isFixed:true},{index:9,direction:2,isFixed:true},{index:16,direction:0,isFixed:true},{index:18,direction:0,isFixed:true},{index:21,direction:1,isFixed:true},{index:23,direction:1,isFixed:true}],disabledNodes:[]},{acornNodes:[2,4,6,8,10,14,16,18,20,22],directionNodes:[{index:0,direction:1,isFixed:false},{index:1,direction:1,isFixed:true},{index:2,direction:0,isFixed:false},{index:3,direction:1,isFixed:true},{index:4,direction:0,isFixed:false},{index:5,direction:2,isFixed:true},{index:6,direction:0,isFixed:false},{index:7,direction:2,isFixed:false},{index:8,direction:0,isFixed:false},{index:9,direction:2,isFixed:true},{index:10,direction:0,isFixed:false},{index:11,direction:0,isFixed:false},{index:13,direction:0,isFixed:false},{index:14,direction:0,isFixed:false},{index:15,direction:2,isFixed:true},{index:16,direction:0,isFixed:false},{index:17,direction:2,isFixed:false},{index:18,direction:0,isFixed:false},{index:19,direction:2,isFixed:true},{index:20,direction:0,isFixed:false},{index:21,direction:1,isFixed:true},{index:22,direction:0,isFixed:false},{index:23,direction:1,isFixed:true},{index:24,direction:0,isFixed:false}],disabledNodes:[12]},{acornNodes:[1,3,5,7,9,11,13,15,17,19,21,23],directionNodes:[{index:0,direction:1,isFixed:false},{index:1,direction:0,isFixed:false},{index:11,direction:2,isFixed:true},{index:13,direction:0,isFixed:true},{index:19,direction:0,isFixed:false},{index:23,direction:3,isFixed:false}],disabledNodes:[]},{acornNodes:[2,4,6,8,10,14,16,18,20,22],directionNodes:[{index:0,direction:1,isFixed:false},{index:1,direction:1,isFixed:true},{index:2,direction:0,isFixed:false},{index:5,direction:2,isFixed:true},{index:6,direction:2,isFixed:false},{index:7,direction:3,isFixed:true},{index:10,direction:2,isFixed:false},{index:11,direction:3,isFixed:false},{index:14,direction:0,isFixed:false},{index:15,direction:3,isFixed:false},{index:17,direction:1,isFixed:true},{index:18,direction:3,isFixed:false},{index:19,direction:2,isFixed:true},{index:23,direction:1,isFixed:true}],disabledNodes:[12]}];var u=[{nodeIndex:0,direction:0},{nodeIndex:0,direction:3},{nodeIndex:1,direction:0},{nodeIndex:2,direction:0},{nodeIndex:3,direction:0},{nodeIndex:4,direction:0},{nodeIndex:4,direction:1},{nodeIndex:5,direction:3},{nodeIndex:9,direction:1},{nodeIndex:10,direction:3},{nodeIndex:14,direction:1},{nodeIndex:15,direction:3},{nodeIndex:19,direction:1},{nodeIndex:20,direction:3},{nodeIndex:20,direction:2},{nodeIndex:21,direction:2},{nodeIndex:22,direction:2},{nodeIndex:23,direction:2},{nodeIndex:24,direction:2},{nodeIndex:24,direction:1}];this.init=function(){window.addEventListener("resize",this.onResize.bind(this),false);this.initGame()};this.getDirectionClass=function(e){var t="";switch(e){case 0:t="up";break;case 1:t="right";break;case 2:t="down";break;case 3:t="left";break}return t};this.addNodeDirectionClass=function(e,t){var n=_.matches({nodeIndex:e,direction:t});var i=_.filter(u,n);if(i.length>0){return}r[e].addClass(this.getDirectionClass(t))};this.checkPath=function(e){var t=0;var i=[];var s=0;var u=-1;while(s>-1){var a=r[s];var f=e?"node-gameover":"node-disabled";if(!_.contains(i,a)&&!a.hasClass(f)){a.removeClass("up right down left");a.addClass("selected");this.addNodeDirectionClass(s,u);i.push(a);if(a.hasClass("node-acorn")){t++}if(s==24){s=-1}else{var l=a.data("direction");this.addNodeDirectionClass(s,l);switch(l){case 0:s=s<=4?-1:s-5;u=2;break;case 1:s=s%5==4?-1:s+1;u=3;break;case 2:s=s>=20?-1:s+5;u=0;break;case 3:s=s%5==0?-1:s-1;u=1;break}}}else{var c=i[i.length-1];var h=c.data("direction");var p=a.data("direction");if(Math.abs(p-h)!=2){c.removeClass(this.getDirectionClass(h))}s=-1}}_.each(_.difference(r,i),function(e){e.removeClass("selected up right down left")});var d=e?15:o[n].acornNodes.length;return _.indexOf(r,_.last(i))==24&&t==d};this.loadGrid=function(){$(".game-grid").html("");r=[];for(var e=0;e<25;e++){var t=o[n];var i=$("<li>");if(_.contains(t.disabledNodes,e)){i.addClass("node-disabled")}else{var s;if(e==24){s=$("<img>",{src:"images/acorn_big.png","class":"acorn acorn-big animated rubberBand"});i.append(s)}else{s=$("<img>",{src:"images/arrow.png","class":"arrow"});var u=_.filter(t.directionNodes,_.matches({index:e}));if(u.length>0){var a=u[0];s.transition({rotate:a.direction*90+"deg"});i.data("direction",a.direction);if(a.isFixed){i.addClass("node-fixed")}}else{var f=e==0?0:_.random(3);s.transition({rotate:f*90+"deg"});i.data("direction",f)}i.append(s);if(e==0){var l=$("<img>",{src:"images/squirrel.png","class":"squirrel animated bounce"});i.append(l)}}}if(_.contains(t.acornNodes,e)){i.addClass("node-acorn");var c=$("<img>",{src:"images/acorn.png","class":"acorn"});i.append(c)}r.push(i);$(".game-grid").append(i)}this.checkPath(false);$(".game-grid").addClass("animated fadeIn");$(".game-grid.animated.fadeIn").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".game-grid.animated.fadeIn").removeClass("animated fadeIn")})};this.loadData=function(){var e=this;this.loadGrid();$("ul.game-grid li:not(.node-fixed):not(.node-disabled)").click(function(){$(this).data("direction",($(this).data("direction")+1)%4);$(this).find("img.arrow").transition({rotate:"+=90deg"});if(e.checkPath(false)){_.delay(function(){swal({title:"Good Job!",type:"success",confirmButtonText:"Next",confirmButtonColor:"#59FF6D",closeOnConfirm:n+1!=o.length},function(){e.loadNextRound();$("html, body").animate({scrollTop:$("#panel-container").offset().top},"fast")})},300)}})};this.loadNextRound=function(){var e=this;if(++n==o.length){e.endGame()}else{e.loadData()}};this.onResize=function(t){if($(window).width()!=e){e=$(window).width();if(i){i.html("")}var n=$(".game-grid").children("li");var r=_.max(n,function(e){return $(e).width()});var s=$(r).width();var o="<style>"+" ul.game-grid { width: "+(s*5+2)+"px; } "+" .game-grid li { height: "+s+"px; width: "+s+"px; } "+" .game-grid li .content { font-size: "+s*.5+"px; } "+" #result-content { font-size: "+s*.8+"px; } "+" .game-letters span { font-size: "+s*.2+"px; margin-left: "+s*.1+"px; } "+"</style>";if(i){i.html(o)}else{i=$("<div />",{html:o}).appendTo("body")}}};this.preloadImage=function(){var e=new Image;e.src="images/love.png"};this.initGame=function(){t=s.INITIAL;this.preloadImage();var e=this;$(".icon-repeat").click(function(){e.startGame()})};this.startGame=function(){t=s.START;n=0;$("#replay").hide();this.loadData();e=0;this.onResize()};this.endGame=function(){t=s.END;var e=this;$(".game-grid").html("");var n={acornNodes:[1,2,3,4,9,10,11,12,13,14,15,20,21,22,23],letterNodes:[{index:5,letter:"G"},{index:6,letter:"A"},{index:7,letter:"M"},{index:8,letter:"E"},{index:16,letter:"O"},{index:17,letter:"V"},{index:18,letter:"E"},{index:19,letter:"R"}],directionNodes:[{index:0,direction:1,isFixed:false},{index:1,direction:0,isFixed:false},{index:4,direction:2,isFixed:true},{index:10,direction:2,isFixed:true},{index:14,direction:3,isFixed:true},{index:20,direction:1,isFixed:true},{index:23,direction:3,isFixed:false}]};r=[];for(var i=0;i<25;i++){var o=$("<li>");var u;if(i==24){u=$("<img>",{src:"images/acorn_big.png","class":"acorn acorn-big animated rubberBand"});o.append(u)}else{var a=_.filter(n.letterNodes,_.matches({index:i}));if(a.length>0){var f=$("<div>",{"class":"content animated fadeIn letter",html:a[0].letter});o.append(f);o.addClass("node-gameover")}else{u=$("<img>",{src:"images/arrow.png","class":"arrow"});var l=_.filter(n.directionNodes,_.matches({index:i}));if(l.length>0){var c=l[0];u.transition({rotate:c.direction*90+"deg"});o.data("direction",c.direction);if(c.isFixed){o.addClass("node-fixed")}}else{var h=i==0?0:_.random(3);u.transition({rotate:h*90+"deg"});o.data("direction",h)}o.append(u);if(i==0){var p=$("<img>",{src:"images/squirrel.png","class":"squirrel animated bounce"});o.append(p)}}}if(_.contains(n.acornNodes,i)){o.addClass("node-acorn");var d=$("<img>",{src:"images/acorn.png","class":"acorn"});o.append(d)}r.push(o);$(".game-grid").append(o)}this.checkPath(true);$("#replay").show();var v=false;$("ul.game-grid li:not(.node-fixed):not(.node-disabled)").click(function(){$(this).data("direction",($(this).data("direction")+1)%4);$(this).find("img.arrow").transition({rotate:"+=90deg"});if(e.checkPath(true)&&!v){swal({title:"8512",text:"The number of different paths for the squirrel to move from top left to bottom right without visiting the same square twice!",imageUrl:"images/main_squirrel.png"});v=true}});$(".letter").click(function(){$(this).addClass("shake")});$(".letter").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("shake fadeIn")});swal({title:"Thanks for playing!!!",imageUrl:"images/love.png"})};this.isGameStateInitial=function(){return t==s.INITIAL};this.isGameStateStart=function(){return t==s.START};this.isGameStateEnd=function(){return t==s.END}}